var NSListDragDrop = function(nsList)
{
	this.__nsList = nsList;
	this.util = nsList.util;
	
	this.__dragListItem = null;
	this.__emptyListItem = null;
	
	this.__initialize = function()
	{
		
	};
	
	this.__prepareListContainer = function()
	{
		var listContainer = this.__nsList.__listContainer;
		var self = this;
		var dropHandler = function(event)
		{
			event = self.util.getEvent(event);
			self.util.preventDefault(event);
			self.util.insertAfterElement(listContainer.firstChild,self.__dragListItem);
		};
		var dragOverHandler = function(event)
		{
			event = self.util.getEvent(event);
			self.util.preventDefault(event);
			self.util.insertAfterElement(listContainer.firstChild,self.__emptyListItem);
			self.__emptyListItem.style.display = "";
		};
		this.util.addStyleClass(listContainer,"dropdivs");
		this.util.addEvent(listContainer,"drop",dropHandler);
		this.util.addEvent(listContainer,"dragover",dragOverHandler);
	};
	
	this.__prepareListItem = function(listItem)
	{
		if(listItem)
		{
			var self = this;
			var dragStartHandler = function(event)
			{
				event = self.util.getEvent(event);
				self.__dragListItem = this;
				event.dataTransfer.setData("Text","");
			};
			var dragOverHandler = function(event)
			{
				event = self.util.getEvent(event);
				self.util.preventDefault(event);
				event.stopPropagation();
				if(listItem == self.__dragListItem)
				{
					return;
				}
				self.util.insertAfterElement(listItem,self.__emptyListItem);
				self.__emptyListItem.style.display = "";
			};
			listItem.setAttribute("draggable",true);
			this.util.addEvent(listItem,"dragstart",dragStartHandler);
			this.util.addEvent(listItem,"dragover",dragOverHandler);
			this.util.addEvent(listItem,"drop",this.__dropHandler.bind(this));
			this.util.addEvent(listItem,"dragend",this.__dragEndHandler.bind(this));
			
		}
	};
	
	this.__createEmptyListItem = function()
	{
		if(!this.__emptyListItem)
		{
			var self = this;
			var dragOverHandler = function(event)
			{
				event = self.util.getEvent(event);
				self.util.preventDefault(event);
				event.stopPropagation();
			};
			var listItem = this.util.createElement("li",null,"dragitems");
			listItem.innerHTML = "<div class='insertDiv draglabels'>&nbsp;</div>";
			this.util.addEvent(listItem,"drop",this.__dropHandler.bind(this));
			this.util.addEvent(listItem,"dragover",dragOverHandler);
			this.__emptyListItem = listItem;
		}
	};
	
	this.__dropHandler = function(event)
	{
		if(this.__emptyListItem && this.__dragListItem)
		{
			event = this.util.getEvent(event);
			this.util.preventDefault(event);
			event.stopPropagation();
			this.util.insertAfterElement(this.__dragListItem,this.__emptyListItem);
		}
	};
	
	this.__dragEndHandler = function(event)
	{
		if(this.__emptyListItem)
		{
			this.__emptyListItem.style.display = "none";
		}
	};
	
	this.__initialize();
};
this.__nsListDragDrop = null;
this.__nsListDragDrop = new NSListDragDrop(this);
this.__nsListDragDrop.__prepareListContainer();
