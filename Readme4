"use strict"; 
function NSFlatGrid(nsGrid,nsUtil) 
{
	this.__nsGrid = nsGrid;
	this.util = nsUtil;
}
/********************************Common Functions for Grid ****************************************/
NSFlatGrid.prototype.__initialize = function ()
{
	
};

NSFlatGrid.prototype.propertyChange = function(attrName, oldVal, newVal, setProperty) 
{
	var attributeName = attrName.toLowerCase();
	if(attributeName === "pageSize" && parseInt(this.__nsGrid.getAttribute("pageSize")) > 0)
	{
		this.__nsGrid.__pageSize = parseInt(this.__nsGrid.getAttribute("pageSize"));
		this.__nsGrid.dataSource(this.__nsGrid.__dataSource);
	}
};

NSFlatGrid.prototype.dataSource = function(source)
{
	this.__nsGrid.__arrWrapper = this.__nsGrid.__dataSource.slice(0);
	this.__setWrapperSource(this.__nsGrid.__arrWrapper,0);
	if(this.__nsGrid.__enablePagination && this.__nsGrid.__isPaginationModeAuto)
	{
		this.__nsGrid.__updateTotalRecords(this.__nsGrid.__arrWrapper.length);
		if(this.__nsGrid.__isPaginationTypeScroll)
		{
			this.__nsGrid.__arrInternalSource = this.__nsGrid.__arrWrapper.slice(0,this.__nsGrid.__INFINITE_SCROLL_INITIAL_LOAD);
			this.__nsGrid.__fetchRecordCallBack = this.__addRowsforScrollPagination.bind(this);
		}
		else 
		{
			this.__nsGrid.__arrInternalSource = this.__nsGrid.__arrWrapper.slice(0,this.__nsGrid.__pageSize);
			this.__nsGrid.__createPaginationControl(this.__nsGrid.__divOuterContainer);
			this.__nsGrid.__fetchRecordCallBack = this.__addRowsforPagePagination.bind(this);
		}
	}
	else
	{
		this.__nsGrid.__arrInternalSource = this.__nsGrid.__arrWrapper.slice(0);
		this.__nsGrid.__updateTotalRecords();
	}
};

NSFlatGrid.prototype.__createBody = function()
{
};

NSFlatGrid.prototype.__createBodyBody= function(dataSet,startIndex,endIndex)
{
    if(dataSet && dataSet.length > 0)
    {
    	 for (var rowIndex = startIndex; rowIndex < endIndex; rowIndex++)
	     {
    		var item = dataSet[rowIndex];
    		var row = item[this.__nsGrid.__fieldRowHtml];
    		this.__nsGrid.__tblBodyBody.appendChild(row);
	     }
    }
};

NSFlatGrid.prototype.__checkForAdditionalColumns = function()
{
};

NSFlatGrid.prototype.__addSVGInPage = function(objSVG)
{
};

NSFlatGrid.prototype.__setMeasurement = function()
{
	
};

NSFlatGrid.prototype.__setWrapperSource = function(source,offset)
{
	if(source)
	{
		if(!offset)
		{
			offset = 0;
		}
		var length = source.length;
		for (var count = 0; count < length; count++) 
		{
			var item = source[count];
			var row = document.createElement("TR");
			var index = count + offset;
			row.setAttribute("index",index);
			item[this.__nsGrid.__fieldIndex] = index;
			item[this.__nsGrid.__fieldRowHtml] = row;
			this.__nsGrid.__setBodyRowProperty(row,item,index);
			var colLength = this.__nsGrid.__columns.length;
			for (var colIndex = 0; colIndex < colLength; colIndex++)
	        {
	        	var colItem = this.__nsGrid.__columns[colIndex];
	        	var cell =  row.insertCell(-1);
	        	this.util.addStyleClass(cell , "nsDataGridCell");
	            var cellDiv = this.util.createDiv(null);
	            this.util.addStyleClass(cellDiv,this.__nsGrid.__CLASS_CELL_CHILD);
	            this.__nsGrid.__addCellText(row,item,cellDiv,colItem,colIndex);
	            cell.appendChild(cellDiv);
	        }
		}
	}
};
/********************************Common Functions for Grid ****************************************/
NSFlatGrid.prototype.__addRowsforScrollPagination = function(fromRecord,toRecord,pageSize)
{
	console.log("In __addRowsforScrollPagination " + fromRecord + "," + toRecord + "," + pageSize);
	var arrArray = this.__nsGrid.__arrWrapper.slice(fromRecord,toRecord + 1); 
	this.__nsGrid.__addRemoveRowCallInternal = true;
	this.__nsGrid.addRows(arrArray);
};

NSFlatGrid.prototype.__addRowsforPagePagination = function(fromRecord,toRecord,pageSize)
{
	//slice returns index range from fromRecord to toRecord - 1 hence adding 1 
	this.__nsGrid.__arrInternalSource = this.__nsGrid.__arrWrapper.slice(fromRecord,toRecord + 1);
	this.__nsGrid.__resetDataInBody(fromRecord,toRecord,true);
};
